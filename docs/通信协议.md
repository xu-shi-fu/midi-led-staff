# 通信协议
(MLS-CP, MLS控制协议)

MLS 控制器与上位机通过基于数据报文的协议进行通信.
具体的, 这个协议可通过蓝牙或wifi传输. 
如果使用wifi传输, 将工作于UDP上.
如果使用蓝牙传输, 将工作于(todo)上.

## 基本的报文结构


MLS-CP 采用二进制的编码格式, 对于多字节的数据, 按网络字节顺序排列.
每个报文由一个或多个block组成. 
每个block有如下结构:

| 字段名 | 长度(in byte) | 说明                                             |
| ------ | ------------- | ------------------------------------------------ |
| size   | 1             | 整个 block 的大小,包括 size 本身 ,单位是byte     |
| type   | 1             | 这个 block 表示的字段类型                        |
| group  | 1             | 这个 block 所属分组的 ID , 默认为0, 表示公共分组 |
| field  | 1             | 这个 block 表示的字段 ID                         |
| value  | n             | 长度取决于字段类型                               |


## 报文字段类型


| type | value 的长度 (in bits)        | 含义          |
| ---- | ----------------------------- | ------------- |
| 0    | 0                             | 无 value      |
| 0x01 | 8                             | uint8         |
| 0x02 | 16                            | uint16        |
| 0x03 | 32                            | uint32        |
| 0x04 | 64                            | uint64        |
| 0x05 |                               |               |
| 0x06 |                               |               |
| 0x11 | 8                             | int8          |
| 0x12 | 16                            | int16         |
| 0x13 | 32                            | int32         |
| 0x14 | 64                            | int64         |
|      |                               |               |
| 0x21 | 32                            | float         |
| 0x22 | 64                            | double        |
|      |                               |               |
| 0x31 | 8 (只使用其中的最低位)        | boolean       |
| 0x32 | n(根据 block.size 确定其长度) | string        |
| 0x33 | n(根据 block.size 确定其长度) | bytes         |
|      |                               |               |
| 0x41 | 32                            | ARGB (色彩值) |





## 报文分组ID

| ID      | 含义            |
| ------- | --------------- |
| 0       | 公共分组(默认)  |
| 1       | 系统功能        |
| 2       | MIDI 功能       |
| 3       | LED 功能        |
| 4       |                 |
| 5       |                 |
|         |                 |
| 128~255 | 扩展 (用户定义) |

## 报文字段ID

报文字段的ID 需要结合具体的 group-ID 来确定其具体含义.


